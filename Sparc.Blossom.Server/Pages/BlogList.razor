@page "/blogs"
@page "/blogs/{ChannelId}"

<div class="blog-list">
    <div class="background"><img src="images/Pattern_1.png" alt="background image" /></div>
    <h1>21 Days of Blossom</h1>
    <h2>Blog</h2>
    <div class="blog-post-list">
        @foreach (var post in Content)
        {
            <div @onclick="@(e => GoTo(post))">
                <BlogPost Post="post" />
            </div>
        }
    </div>
</div>

@inject NavigationManager Navigation

@code {
    public bool img = false;
    [Parameter] public string? ChannelId { get; set; } = null!;
    List<string> DefaultChannels = new() { "new-blossom-blog" };
    List<IbisContent> Content = new();

    protected override async Task OnInitializedAsync()
    {
        if (ChannelId != null)
        {
            var channel = await Ibis.GetAllAsync(ChannelId, asHtml: true);
            Content.AddRange(channel!.Content);
        }
        else
        {
            foreach (var channel in DefaultChannels)
            {
                var channelContent = await Ibis.GetAllAsync(channel, asHtml: true);
                Content.AddRange(channelContent!.Content);
            }
            Content = Content.OrderByDescending(x => x.Timestamp).ToList();
        }
    }

    public void GoTo(IbisContent content) => Nav.NavigateTo($"/blogs/{content.RoomSlug}/{content.Tag}");
}
